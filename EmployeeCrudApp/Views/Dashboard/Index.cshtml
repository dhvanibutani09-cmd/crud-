@{
    ViewData["Title"] = "Dashboard";
}

<div class="container mt-4">
    <h1 class="text-center mb-4">Welcome to Your Dashboard</h1>
    
    <div class="row g-4">
        <!-- Weather Card -->
        <div class="col-md-4">
            <div class="card h-100 shadow border-0 rounded-4 glass-card">
                <div class="card-body text-center p-4">
                    <div class="icon-circle bg-primary text-white mb-3 mx-auto">
                        <i class="bi bi-cloud-sun-fill"></i>
                    </div>
                    <h5 class="card-title fw-bold">Weather Details</h5>
                    <div id="weather-content" class="mt-3">
                        <p class="text-muted">Loading weather...</p>
                    </div>
                    <div class="mt-3">
                        <input type="text" id="city-input" class="form-control form-control-sm mb-2" placeholder="Enter city (e.g. London)">
                        <button onclick="updateWeather()" class="btn btn-primary btn-sm w-100 rounded-pill">Update Weather</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Currency Conversion Card -->
        <div class="col-md-4">
            <div class="card h-100 shadow border-0 rounded-4 glass-card">
                <div class="card-body text-center p-4">
                    <div class="icon-circle bg-success text-white mb-3 mx-auto">
                        <i class="bi bi-currency-exchange"></i>
                    </div>
                    <h5 class="card-title fw-bold">Currency Conversion</h5>
                    <div class="mt-3">
                        <div class="input-group input-group-sm mb-2">
                            <span class="input-group-text">Amount</span>
                            <input type="number" id="amount" class="form-control" value="1">
                        </div>
                        <div class="row g-2 mb-2">
                            <div class="col">
                                <select id="from-currency" class="form-select form-select-sm">
                                    <option value="USD" selected>USD</option>
                                    <option value="EUR">EUR</option>
                                    <option value="GBP">GBP</option>
                                    <option value="INR">INR</option>
                                    <option value="JPY">JPY</option>
                                </select>
                            </div>
                            <div class="col">
                                <select id="to-currency" class="form-select form-select-sm">
                                    <option value="EUR" selected>EUR</option>
                                    <option value="USD">USD</option>
                                    <option value="GBP">GBP</option>
                                    <option value="INR">INR</option>
                                    <option value="JPY">JPY</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="convertCurrency()" class="btn btn-success btn-sm w-100 rounded-pill">Convert</button>
                        <div id="currency-result" class="mt-3 fw-bold fs-5"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time Conversion Card -->
        <div class="col-md-4">
            <div class="card h-100 shadow border-0 rounded-4 glass-card">
                <div class="card-body text-center p-4">
                    <div class="icon-circle bg-info text-white mb-3 mx-auto">
                        <i class="bi bi-clock-fill"></i>
                    </div>
                    <h5 class="card-title fw-bold">Time Conversion</h5>
                    <div class="mt-3">
                        <div class="mb-2">
                            <label class="form-label small text-muted">Current Local Time:</label>
                            <div id="local-time" class="fw-bold"></div>
                        </div>
                        <div class="mb-3">
                            <select id="timezone-select" class="form-select form-select-sm" onchange="updateTargetTime()">
                                <option value="UTC">UTC (GMT)</option>
                                <option value="America/New_York">New York (EST/EDT)</option>
                                <option value="Europe/London">London (GMT/BST)</option>
                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                                <option value="Australia/Sydney">Sydney (AEST/AEDT)</option>
                                <option value="Asia/Kolkata">Mumbai (IST)</option>
                            </select>
                        </div>
                        <div class="p-3 bg-light rounded-3">
                            <label class="form-label small text-muted">Time in Selected Zone:</label>
                            <div id="target-time" class="fw-bold fs-5"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .glass-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1) !important;
    }
    .icon-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
    }
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

@section Scripts {
    <script>
        // --- Weather Logic ---
        async function fetchWeather(city = '') {
            const content = document.getElementById('weather-content');
            try {
                // Using wttr.in for weather data
                const response = await fetch(`https://wttr.in/${city}?format=j1`);
                const data = await response.json();
                
                const current = data.current_condition[0];
                const area = data.nearest_area[0];
                
                content.innerHTML = `
                    <div class="fs-2 fw-bold">${current.temp_C}Â°C</div>
                    <div class="text-capitalize">${current.weatherDesc[0].value}</div>
                    <div class="small text-muted mt-2">
                        <i class="bi bi-geo-alt-fill"></i> ${area.areaName[0].value}, ${area.country[0].value}
                    </div>
                    <div class="mt-2 small">
                        Humidity: ${current.humidity}% | Wind: ${current.windspeedKmph} km/h
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<span class="text-danger">Failed to load weather data.</span>`;
                console.error('Weather error:', error);
            }
        }

        function updateWeather() {
            const city = document.getElementById('city-input').value;
            fetchWeather(city);
        }

        // --- Currency Logic ---
        async function convertCurrency() {
            const amount = document.getElementById('amount').value;
            const from = document.getElementById('from-currency').value;
            const to = document.getElementById('to-currency').value;
            const resDiv = document.getElementById('currency-result');

            resDiv.innerHTML = '<span class="small text-muted">Converting...</span>';

            try {
                const response = await fetch(`https://open.er-api.com/v6/latest/${from}`);
                const data = await response.json();
                
                if (data.result === "success") {
                    const rate = data.rates[to];
                    const converted = (amount * rate).toFixed(2);
                    resDiv.innerHTML = `${amount} ${from} = ${converted} ${to}`;
                } else {
                    resDiv.innerHTML = 'Error fetching rates';
                }
            } catch (error) {
                resDiv.innerHTML = 'Error converting';
                console.error('Currency error:', error);
            }
        }

        // --- Time Logic ---
        function updateTimes() {
            const now = new Date();
            document.getElementById('local-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            updateTargetTime();
        }

        function updateTargetTime() {
            const timezone = document.getElementById('timezone-select').value;
            const now = new Date();
            const targetTimeStr = now.toLocaleTimeString('en-US', { 
                timeZone: timezone, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('target-time').innerText = targetTimeStr;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchWeather(); // Default location
            setInterval(updateTimes, 1000);
            updateTimes();
            convertCurrency();
        });
    </script>
}
